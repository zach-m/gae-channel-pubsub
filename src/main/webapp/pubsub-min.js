(function(){function i(e){var t=new goog.appengine.Channel(e);t.open({onopen:function(){s("*** onopen ***");n=true;r.listener.onConnect()},onmessage:function(e){s("*** onmessage: "+JSON.stringify(e));data=JSON.parse(e.data);r.listener.onMessageReceived(data.msg,data.topic)},onerror:function(e){s("*** onerror: "+JSON.stringify(e));r.listener.onError(e.code,e.description)},onclose:function(){s("*** onclose ***");n=false;r.listener.onDisconnect()}})}function s(e){if(r.config.verbose)console.log(e)}var e=null;var t=null;var n=false;var r={config:{verbose:true},listener:{onConnect:function(){},onDisconnect:function(){},onMessageReceived:function(e,t){},onMessageSent:function(e,t){},onError:function(e,t){},onToken:function(e){},onSubscribe:function(e,t){}},connect:function(n){e=n;$.ajax({type:"GET",url:e,success:function(e){t=e.trim();s("*** ontoken: "+t);r.listener.onToken(t);i(t)}})},subscribe:function(n){$.ajax({type:"GET",url:e+"/subscribe/"+n+"/"+t,success:function(e){subCount=e.subCount;s("*** onsubscribe: "+n+"  ("+subCount+" subscribers)");r.listener.onSubscribe(n,subCount)}})},publish:function(n,i,o){var u=o&&o==true?"?exclude="+t:"";$.ajax({type:"POST",url:e+"/"+n+u,data:i,contentType:"text/plain; charset=utf-8",success:function(e){s("*** onpublish ("+n+"): "+i);r.listener.onMessageSent(i,e.subCount)}})}};window.pubsub=r})()